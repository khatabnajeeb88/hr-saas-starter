<!DOCTYPE html>
<html lang="{{ app.request.locale }}" dir="{{ app.request.locale == 'ar' ? 'rtl' : 'ltr' }}">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        <script>
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark')
            } else {
                document.documentElement.classList.remove('dark')
            }
        </script>
        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
            {# {% block importmap %}{{ importmap('app') }}{% endblock %} #}
        {% endblock %}
    </head>
    <body class="bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen">
        {% if is_granted('IS_IMPERSONATOR') %}
            <div class="bg-amber-100 border-l-4 border-amber-500 text-amber-700 p-4 sticky top-0 z-50 flex justify-between items-center" role="alert">
                <div>
                    <p class="font-bold">Impersonation Mode</p>
                    <p>You are currently acting as {{ app.user.email }}.</p>
                </div>
                <a href="{{ path('admin', {'_switch_user': '_exit'}) }}" class="bg-amber-500 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded">
                    Exit Impersonation
                </a>
            </div>
        {% endif %}

        {% block body %}{% endblock %}
        
        {% if app.user %}
            {% include '_notifications.html.twig' with {
                mercure_url: mercure('https://example.com/users/' ~ app.user.id ~ '/notifications'),
                topics: ['https://example.com/users/' ~ app.user.id ~ '/notifications']
            } %}
        {% endif %}
    </body>
</html>
