{% extends 'base.html.twig' %}

{% block body %}
<div class="drawer lg:drawer-open group">
    <input id="dashboard-drawer" type="checkbox" class="drawer-toggle" checked />
    <script>
        (function() {
            try {
                const savedState = localStorage.getItem('sidebar-expanded');
                // Default is true (checked). If savedState is explicitly 'false', uncheck it.
                if (savedState === 'false') {
                    document.getElementById('dashboard-drawer').checked = false;
                }
            } catch (e) {}
        })();
    </script>
    
    {# Drawer Content (Navbar + Page) #}
    <div class="drawer-content flex flex-col min-h-screen bg-slate-50 dark:bg-slate-900 transition-all duration-300">
        {# Navbar Component #}
        {% include 'components/dashboard/navbar.html.twig' %}
        
        {% if is_granted('IS_IMPERSONATOR') %}
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 sticky top-0 z-50 flex justify-between items-center" role="alert">
                <div>
                    <p class="font-bold">Impersonation Mode</p>
                    <p>You are currently acting as {{ app.user.email }}.</p>
                </div>
                <a href="{{ path('admin', {'_switch_user': '_exit'}) }}" class="bg-yellow-800 hover:bg-yellow-700 text-black font-bold py-2 px-4 rounded">
                    Exit Impersonation
                </a>
            </div>
        {% endif %}

        {# Page Content #}
        <main class="flex-1 p-6">
            {% block dashboard_content %}{% endblock %}
        </main>
        
        {# Footer Component #}
        {% include 'components/dashboard/footer.html.twig' %}
    </div>

    {# Drawer Side (Sidebar) #}
    <div class="drawer-side z-50 lg:overflow-visible">
        <label for="dashboard-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        {% include 'components/dashboard/sidebar.html.twig' with {
            'user': app.user,
            'currentRoute': app.request.attributes.get('_route')
        } %}
    </div>
</div>

{% endblock %}

