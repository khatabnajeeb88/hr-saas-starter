{% extends 'layouts/portal.html.twig' %}

{% block portal_content %}
	<div class="max-w-4xl mx-auto">
		<div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
			<div>
				<h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100">My Documents</h2>
				<p class="text-slate-500 dark:text-slate-400">Manage your employment documents</p>
			</div>
			<button onclick="upload_modal.showModal()" class="btn btn-primary bg-purple-600 hover:bg-purple-700 text-white border-none gap-2">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
				</svg>
				Upload Document
			</button>
		</div>

		{# Contracts Section (if any) #}
		{# Ideally we would loop through employee.contracts here if we want to show generated contracts #}
		{% if employee.contracts|length > 0 %}
			<div class="mb-8">
				<h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2">
					<svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
					</svg>
					Employment Contracts
				</h3>
				<div class="grid gap-4">
					{% for contract in employee.contracts %}
						<div class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 flex items-center justify-between shadow-sm">
							<div class="flex items-center gap-4">
								<div class="w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600">
									<svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
									</svg>
								</div>
								<div>
									<h4 class="font-bold text-slate-800 dark:text-slate-100">Employment Contract</h4>
									<p class="text-xs text-slate-500">
										{{ contract.startDate|date('M d, Y') }}
										-
										{% if contract.endDate %}
											{{ contract.endDate|date('M d, Y') }}
										{% else %}
											Indefinite
										{% endif %}
									</p>
								</div>
							</div>
							{# Assuming contracts might have a download link or generated PDF. Placeholder for now as Contract entity doesn't show file path explicitly in viewed file #}
							<button class="btn btn-ghost btn-sm btn-square text-slate-400">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
								</svg>
							</button>
						</div>
					{% endfor %}
				</div>
			</div>
		{% endif %}

		{# Uploaded Documents #}
		<div class="space-y-4">
			<h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2">
				<svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
				</svg>
				Uploaded Documents
			</h3>

			{% if employee.documents|length > 0 %}
				<div class="grid gap-4">
					{% for doc in employee.documents %}
						{% set isExpired = doc.isExpired() %}
						{% set daysLeft = doc.getDaysUntilExpiry() %}
						<div class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 flex flex-col sm:flex-row sm:items-center justify-between shadow-sm relative overflow-hidden group gap-4">
							{% if isExpired %}
								<div class="absolute inset-y-0 left-0 w-1 bg-red-500"></div>
							{% elseif daysLeft is not null and daysLeft < 30 %}
								<div class="absolute inset-y-0 left-0 w-1 bg-yellow-500"></div>
							{% endif %}

							<div class="flex items-start sm:items-center gap-4 min-w-0">
								<div class="w-10 h-10 rounded-lg bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 shrink-0 mt-1 sm:mt-0">
									{% if doc.file ends with '.pdf' %}
										<svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
										</svg>
									{% else %}
										<svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
										</svg>
									{% endif %}
								</div>
								<div class="min-w-0">
									<div class="flex flex-wrap items-center gap-2">
										<h4 class="font-bold text-slate-800 dark:text-slate-100 capitalize truncate">{{ doc.type|replace({'_': ' '}) }}</h4>
										{% if isExpired %}
											<span class="badge badge-error badge-sm shrink-0">Expired</span>
										{% elseif daysLeft is not null and daysLeft < 30 %}
											<span class="badge badge-warning badge-sm shrink-0">Expiring in
												{{ daysLeft }}
												days</span>
										{% endif %}
									</div>
									<p class="text-xs text-slate-500 mt-0.5 truncate">
										{% if doc.documentNumber %}No:
											<span class="font-mono">{{ doc.documentNumber }}</span>
											â€¢
										{% endif %}
										{% if doc.expiryDate %}Expires:
											{{ doc.expiryDate|date('M d, Y') }}{% else %}No Expiry
										{% endif %}
									</p>
								</div>
							</div>

							<a href="{{ path('app_employee_portal_documents_download', {'id': doc.id}) }}" class="btn btn-ghost btn-sm btn-square text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/40 self-end sm:self-center shrink-0" title="Download">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4-4m0 0l-4 4m4-4v12"></path>
								</svg>
							</a>
						</div>
					{% endfor %}
				</div>
			{% else %}
				<div class="text-center py-12 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-300 dark:border-slate-700">
					<svg class="w-12 h-12 text-slate-300 mx-auto mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
					</svg>
					<p class="text-slate-500">No documents uploaded yet.</p>
				</div>
			{% endif %}
		</div>
	</div>

	{# Upload Modal #}
	<dialog id="upload_modal" class="modal modal-bottom sm:modal-middle">
		<div class="modal-box bg-white dark:bg-slate-800">
			<h3 class="font-bold text-lg text-slate-800 dark:text-slate-100 mb-4">Upload Document</h3>
			{{ form_start(form) }}
			<div class="space-y-4">
				<div class="form-control">
					{{ form_label(form.type, null, {'label_attr': {'class': 'label-text font-medium mb-1 block'}}) }}
					{{ form_widget(form.type, {'attr': {'class': 'select select-bordered w-full bg-slate-50'}}) }}
					{{ form_errors(form.type) }}
				</div>
				<div class="form-control">
					{{ form_label(form.documentNumber, null, {'label_attr': {'class': 'label-text font-medium mb-1 block'}}) }}
					{{ form_widget(form.documentNumber, {'attr': {'class': 'input input-bordered w-full bg-slate-50'}}) }}
					{{ form_errors(form.documentNumber) }}
				</div>
				<div class="form-control">
					{{ form_label(form.expiryDate, null, {'label_attr': {'class': 'label-text font-medium mb-1 block'}}) }}
					{{ form_widget(form.expiryDate, {'attr': {'class': 'input input-bordered w-full bg-slate-50'}}) }}
					{{ form_errors(form.expiryDate) }}
				</div>
				<div class="form-control">
					{{ form_label(form.file, null, {'label_attr': {'class': 'label-text font-medium mb-1 block'}}) }}
					{{ form_widget(form.file, {'attr': {'class': 'file-input file-input-bordered w-full bg-slate-50'}}) }}
					{{ form_errors(form.file) }}
				</div>
			</div>
			<div class="modal-action">
				<button type="button" onclick="upload_modal.close()" class="btn">Cancel</button>
				<button type="submit" class="btn btn-primary bg-purple-600 border-none text-white">Upload</button>
			</div>
			{{ form_end(form) }}
		</div>
		<form method="dialog" class="modal-backdrop">
			<button>close</button>
		</form>
	</dialog>
{% endblock %}
